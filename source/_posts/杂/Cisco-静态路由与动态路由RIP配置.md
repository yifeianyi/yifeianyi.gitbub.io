---
title: Cisco-静态路由与动态路由协议RIP配置
date: 2020-10-09 00:23:26
tags: cisco
categories: 杂项
---

### 简介

>我个人对“路由”的这个名字的理解是，“路由哪里来，路到哪里去”。
>
>所以控制报文传输的机器就叫路由器，选择传输路径的协议就叫路由协议。
>
>本文将记述其中最简单的静态路由、动态路由RIP的配置流程

<!--more-->

### 略说原理

每个路由器都自带一张路由表，这个路由表存储着指向特定地址的路径。

这个路径的信息大概会包括：
- 目的IP的网段(或称目的IP的网络号)
- 前往目的IP地址的下一跳IP地址

下一跳IP地址，即与本路由器直连的路由器的地址。所以，可以把路由表理解成路标，报文在传输过程中每到一个路由器都先看看“路标”，才能找到下一步怎么的方向。

至于这个路由表具体是怎么构建的，那就是路由协议干的活。

### 静态路由

静态路由很对得起它的名字，它是真的"静态"！！！

我们只需要给每台路由器配上目的IP地址和下一跳的地址，即可完成一条路径在该路由器上的配置。

而这种配置，在没有进行人为干预的情况下它是不会自动发生改变的。这就意味若一条路径上某个结点出点什么问题，整条路径直接报废。除了解决问题结点外，若要重新建一条新路径，这工作量无疑是巨大的。

我们可以算一笔账：设一条路径上有n个结点（除去起始点和终点后），若一个节点出现故障，那么在不动原路径的情况下（假设原路径经过的结点数最少）创建一条新路径，就至少要重新配置n个结点。若出现故障的问题结点指向了m条不同的路径。那么这个配置的工作量在最坏情况下就要配置n*m个结点。

以上说明，足以说明静态路由不适合现今这个网络结点多达数十亿的信息时代。但对于小型网络、路由学习入门来说，它也是不错的选择，原因就是因为——它很简单，且后面各种动态路由也是在此基础上进行设计优化的。

#### 1.1、示例拓扑

![静态路由拓扑](静态路由拓扑.png)

#### 1.2、实验步骤

- 给各机器配上IP地址
- 在特权模式使用多次ip route 命令建立路由表

#### 1.3、命令

```
//ip地址配置过程省略
Router1(config)#ip route 192.168.20.0 255.255.255.0 192.168.20.2
//配置目的网段(或称网络号)为192.168.20.0的路由
Router1(config)#ip route 192.168.2.0 255.255.255.0 192.168.20.2
//配置目的网段为192.168.2.0的路由

/*
	其他路由配置以此类推。
	格式：
		Router1(config)#ip route 目的网段 掩码 下一跳地址
	值得注意的是：
		1、因为信息是一来一回的，所以对于同一条路径，要在两个方向分别配置一遍。
		2、配置的是目的网段，不是准确IP地址！不是IP地址！！不是IP地址！！！
*/
```

#### 1.4、结果

<img src="静态路由结果（1）.png" alt="静态路由结果（1）" style="zoom:50%;" /><img src="静态路由结果（2）.png" alt="静态路由结果（2）" style="zoom: 50%;" />

由于路由表记录的只有目的网段和下一跳地址，中间经过的设备并不会被自动记录为目的地，所以只在一台机器上ping通所有机器并不代表整个网络中任意两台机器都能ping通。

但由于信息交互式一来一回的，所以只需对称的在一半的机器上验证，能ping通所有机器，即可代表整个网络都处于两两联通的状态。

#### 1.5、查看配置

```
Router#show ip route	//查看路由条目
```

<img src="查看路由条目.png" alt="查看路由条目" style="zoom:67%;" />

绿色框框的信息表示：前往 192.168.10.0/24 的网段 下一跳地址为 192.168.20.1。

### 动态路由

动态路由协议可以分为：

- 内部网关协议
- 外部网关协议

这两大类协议具体有什么区别，在此不做过多叙述。

我们下面先来讨论下内部网关协议中最简单的路由协议——RIP。

在上面**1.5、查看配置**的路由条目图中，我们可以看到，路由器直连的网段是自动收录进路由表的。如下图：

<img src="本地路由条目.png" alt="本地路由条目" style="zoom:50%;" />

而RIP 就是利用了这点。既然每个路由器的路由表都自带了直连网段的信息，辣么两个路由器间互相学习下大家路由表中的信息不就可以自动生成一条条指向各个特定地址的路径了嘛！！！

而且，只要定时互相交流信息、更新自身的路由表，就可以避免静态路由中一个结点发生故障，整条路径都GG的情况，非常人性化。

有了以上认知，我们就可以愉快的进行相关的实验配置了。至于RIP协议更多详细的原理细节，这里不做过多叙述。

#### 2.1、示例拓扑

同**1.1**。

#### 2.2、实验步骤

- 进入RIP协议配置模式
- 换成RIP version2(默认是version 1)
- 公告直连网段

#### 2.3、命令

```
Router(config)#route rip			//进入rip配置模式
Router(config-router)#version 2		//设置为rip version 2
Router(config-router)#network 192.168.10.0	//公告直连的192.168.10.0网段
Router(config-router)#network 192.168.20.0	//公告直连的192.168.20.0网段
/*
	补充说明：
		rip现在有3个版本：
			version 1 :仅支持IPv4有类地址
			version 2 :支持IPv4无类地址
			version 3 :支持IPv6无类地址
*/
```

#### 2.4、结果与配置查看

<img src="动态路由结果.png" alt="动态路由结果" style="zoom:50%;" /><img src="动态路由查看.png" alt="动态路由查看" style="zoom:50%;" />